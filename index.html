<!DOCTYPE html>
<html>

<head>
    <script src="https://cdn.jsdelivr.net/npm/onnxruntime-web/dist/ort.min.js"></script>
    <style>

        html, body {
            margin: 0;
        }

        body {
            height: 100vh;
            width: 100vw;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        img {
            height: 50%;
        }
    </style>
</head>

<body>
    <img id="generatedImage" src="" alt="Generated image" hidden>
    <input type="file" accept=".onnx">
</body>

<script type="module">
    import * as model from './src/index.js'

    // Get elements from the page
    const img = document.querySelector('img')
    const input = document.querySelector('input')

    const framesPerInterpolation = 60

    const vectors = [ model.vectors.generate() ]

    let nFrames = 0

    // Create an animation function to handle image refreshes
    function animate () {
        let vector

        // Create new vector to interpolate to
        const modulus = nFrames % framesPerInterpolation
        if (modulus === 0) vectors.push(model.vectors.generate())
        
        // Interpolate the last two vectors in the array
        const vInter = model.vectors.interpolate(vectors[vectors.length - 2], vectors[vectors.length - 1], modulus / framesPerInterpolation)
        
        // Generate an image based off the interpolated vector
        model.generateImage(vInter).then(dataurl => {
            img.src = dataurl
            img.removeAttribute('hidden')
        })

        // Increment the frame count and request the next frame
        nFrames++
        requestAnimationFrame(animate)
    }

    // A. Run the model whenever the file input changes
    input.onchange = async (ev) => {
        const file = ev.target.files[0]
        await model.load(await file.arrayBuffer()) //
        input.setAttribute('hidden', '')
        animate()
    }

    // // B. Alternatively, you can run the model immediately on load
    // input.setAttribute('hidden', '')
    // const modelURL = './models/faces.onnx'
    // await model.load(modelURL)
    // animate()

</script>

</html>